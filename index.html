<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ParabÃ©ns! ðŸ’— Agende sua consulta</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#fff1ea;

      --card:#ffffffcc;
      --text:#2a2323;
      --muted:#6b5f60;

      --brand:#e96da0;
      --brand2:#ffb69a;
      --border:#f2d7df;

      --shadow: 0 18px 50px rgba(33, 24, 24, .10);
      --radius: 22px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(233,109,160,.18), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(255,182,154,.22), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 28px 16px;
      padding-bottom: calc(28px + env(safe-area-inset-bottom));
    }

    .wrap{
      width: min(980px, 100%);
      display:grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }

    .card{
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 26px;
    }

    h1{
      margin: 6px 0 8px;
      font-size: clamp(24px, 3.4vw, 38px);
      line-height: 1.15;
      letter-spacing: -0.4px;
    }

    p{
      margin: 0;
      color: var(--muted);
      line-height: 1.55;
      font-size: 15.5px;
    }
    .highlight{ color: var(--text); font-weight: 600; }

    .form{
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background:#fff;
    }

    label{
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
      display:block;
      margin-bottom:8px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      outline: none;
      font-family: inherit;
      font-size: 14px;
      background:#fff;
      color: var(--text);
    }
    input:focus{
      border-color: rgba(233,109,160,.55);
      box-shadow: 0 0 0 4px rgba(233,109,160,.10);
    }

    textarea#tzInfo{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      outline: none;
      font-family: inherit;
      font-size: 14px;
      background:#fff;
      color: var(--text);
      resize: none;
      line-height: 1.25;
      height: 54px;
    }
    textarea#tzInfo:focus{
      border-color: rgba(233,109,160,.55);
      box-shadow: 0 0 0 4px rgba(233,109,160,.10);
    }

    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin: 12px 0 10px;
      gap: 10px;
    }
    .sectionTitle b{
      font-size: 13px;
      color: var(--muted);
      letter-spacing: .2px;
    }
    .miniNote{
      font-size: 12.5px;
      color: rgba(107,95,96,.9);
    }

    /* ===== Mobile-friendly day picker: horizontal scroll ===== */
    .days{
      display:grid;
      grid-auto-flow: column;
      grid-auto-columns: minmax(90px, 1fr);
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 6px;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x mandatory;
    }
    .days::-webkit-scrollbar{ height: 8px; }
    .days::-webkit-scrollbar-thumb{ background: rgba(233,109,160,.18); border-radius: 99px; }

    .btnDay{
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 14px;
      padding: 12px 10px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      text-align:center;
      min-height: 62px;
      scroll-snap-align: start;
      touch-action: manipulation;
    }
    .btnDay .dow{
      font-size: 11px;
      color: rgba(107,95,96,.92);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
    }
    .btnDay .dm{
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-top: 3px;
    }
    .btnDay.active{
      border-color: rgba(233,109,160,.55);
      box-shadow: 0 0 0 4px rgba(233,109,160,.10);
      background: linear-gradient(135deg, rgba(233,109,160,.10), rgba(255,182,154,.12));
    }

    /* ===== Mobile-friendly time grid ===== */
    .times{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .btnTime{
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 14px;
      padding: 12px 10px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      text-align:center;
      line-height: 1.15;
      min-height: 64px;
      touch-action: manipulation;
    }
    .btnTime .ct{
      font-weight: 800;
      color: var(--text);
      font-size: 14px;
    }
    .btnTime .local{
      margin-top: 5px;
      font-weight: 700;
      font-size: 12px;
      color: rgba(107,95,96,.92);
      white-space: nowrap;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 14px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 12px 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background:#fff;
      color: var(--text);
      text-decoration:none;
      font-weight: 700;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      cursor:pointer;
      touch-action: manipulation;
    }
    .btn.primary{
      border:none;
      color:#fff;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 16px 35px rgba(233,109,160,.25);
    }

    /* Selected chips */
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 12px; }
    .chip{
      display:inline-flex; align-items:flex-start; gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff7fb;
      font-size: 13px;
      color: var(--text);
      font-weight: 700;
      max-width: 100%;
    }
    .chip span{
      font-weight: 600;
      color: rgba(42,35,35,.78);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 55vw;
    }
    .chip button{
      border:none; background: transparent; cursor:pointer;
      font-size: 14px; line-height: 1; padding: 0 2px;
      color: rgba(42,35,35,.75);
      touch-action: manipulation;
    }

    .list{ margin-top: 14px; display:grid; gap: 10px; }
    .item{
      display:flex; gap: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background:#fff;
    }
    .icon{
      width: 38px; height: 38px;
      border-radius: 14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(233,109,160,.18), rgba(255,182,154,.20));
      border: 1px solid rgba(233,109,160,.18);
      flex: 0 0 auto;
      font-size: 18px;
    }
    .item b{ display:block; margin-bottom: 2px; }
    .mini{ font-size: 13.5px; color: var(--muted); margin-top: 10px; }

    /* ===== Mobile optimization ===== */
    @media (max-width: 720px){
      body{ padding: 18px 12px; padding-bottom: calc(18px + env(safe-area-inset-bottom)); }
      .card{ padding: 18px; border-radius: 20px; }
      .form{ padding: 12px; }
      .row{ grid-template-columns: 1fr; }
      .times{ grid-template-columns: repeat(2, 1fr); }
      .btn{ width: 100%; }
      .actions{ flex-direction: column; }
      /* remove hover lift on touch-ish devices */
      .btnDay:hover, .btnTime:hover, .btn:hover{ transform:none; box-shadow:none; }
    }

    @media (max-width: 380px){
      .times{ grid-template-columns: 1fr; }
      .btnTime .local{ white-space: normal; }
      textarea#tzInfo{ height: 62px; }
    }

    /* Sticky bottom CTA (mobile): keeps WhatsApp button always reachable */
    .stickyCta{
      display:none;
    }
    @media (max-width: 720px){
      .stickyCta{
        position: sticky;
        bottom: 10px;
        z-index: 10;
        margin-top: 14px;
        padding-bottom: env(safe-area-inset-bottom);
        display:block;
      }
      .stickyCta .btn.primary{
        width:100%;
        border-radius: 16px;
        padding: 14px 16px;
        font-size: 15px;
      }
    }
  </style>
</head>

<body>
  <main class="wrap">
    <section class="card">

      <h1>ParabÃ©ns pela sua decisÃ£o. ðŸ’—</h1>
      <p>
        Agora o prÃ³ximo passo Ã© simples: <span class="highlight">me indicar seus horÃ¡rios de preferÃªncia</span>.
        <br/>Essas opÃ§Ãµes nÃ£o significam agenda livre, mas me ajudam a consultar minha agenda
        e te propor o melhor horÃ¡rio possÃ­vel para a sua primeira consulta.
      </p>

      <div class="form">
        <div class="row">
          <div>
            <label for="name">Seu nome</label>
            <input id="name" type="text" placeholder="Ex.: Ana Paula" autocomplete="name" />
          </div>
          <div>
            <label>Fusos horÃ¡rios</label>
            <textarea id="tzInfo" readonly rows="2"></textarea>
          </div>
        </div>

        <div class="sectionTitle">
          <b>1) Escolha um dia</b>
          <div class="miniNote">Arraste para o lado â†’</div>
        </div>
        <div class="days" id="days"></div>

        <div class="sectionTitle" style="margin-top:14px;">
          <b>2) Escolha um horÃ¡rio</b>
          <div class="miniNote" id="timeNote">HorÃ¡rios em Central Time (CT)</div>
        </div>
        <div class="times" id="times"></div>

        <div class="chips" id="chips"></div>

        <div class="actions">
          <button class="btn" id="clearAll" type="button">ðŸ§¹ Limpar</button>
          <a class="btn primary" id="waBtn" href="#" target="_blank" rel="noopener">
            ðŸ’¬ Enviar preferÃªncias no WhatsApp
          </a>
        </div>

        <div class="mini" style="margin-top:10px;">
          Os botÃµes mostram <span class="highlight">Central Time (CT)</span> + o horÃ¡rio no <span class="highlight">seu fuso</span>.
          A mensagem vai com os dois.
        </div>

        <!-- Sticky CTA for mobile -->
        <div class="stickyCta">
          <a class="btn primary" id="waBtnSticky" href="#" target="_blank" rel="noopener">
            ðŸ’¬ Enviar no WhatsApp
          </a>
        </div>
      </div>

      <div class="list">
        <div class="item">
          <div class="icon">âœ…</div>
          <div>
            <b>Depois que vocÃª enviar</b>
            <p>Eu confirmo a melhor opÃ§Ã£o e te passo o link/instruÃ§Ãµes da chamada.</p>
          </div>
        </div>
      </div>

      <p class="mini">
        Se o WhatsApp nÃ£o abrir, mande mensagem para:
        <span class="highlight">+1 (765) 701-9539</span>
      </p>
    </section>
  </main>

  <script>
    // ===== CONFIG =====
    const WHATSAPP_NUMBER = "17657019539";
    const MAX_SLOTS = 3;
    const CT_TZ = "America/Chicago";
    const DAYS_AHEAD = 14;

    function generateTimesHalfHour(startHH, startMM, endHH, endMM){
      const times = [];
      let total = startHH * 60 + startMM;
      const endTotal = endHH * 60 + endMM;

      while(total <= endTotal){
        const hh = String(Math.floor(total / 60)).padStart(2, "0");
        const mm = String(total % 60).padStart(2, "0");
        times.push(`${hh}:${mm}`);
        total += 30;
      }
      return times;
    }

    // 9:00 AM atÃ© 6:00 PM (Central Time), de 30 em 30 min
    const AVAILABLE_TIMES = generateTimesHalfHour(9, 0, 18, 0);

    // ===== ELEMENTS =====
    const nameEl = document.getElementById("name");
    const tzInfoEl = document.getElementById("tzInfo");
    const daysEl = document.getElementById("days");
    const timesEl = document.getElementById("times");
    const chipsEl = document.getElementById("chips");
    const clearBtn = document.getElementById("clearAll");
    const waBtn = document.getElementById("waBtn");
    const waBtnSticky = document.getElementById("waBtnSticky");
    const timeNote = document.getElementById("timeNote");

    // ===== STATE =====
    let selectedDayISO = null; // "YYYY-MM-DD"
    let slots = []; // { key, localLabel, ctLabel, dateISO, timeHHMM }

    // ===== HELPERS =====
    function pad2(n){ return String(n).padStart(2,"0"); }

    function getLocalTimeZone(){
      try { return Intl.DateTimeFormat().resolvedOptions().timeZone || "Local"; }
      catch(e){ return "Local"; }
    }

    function isoFromDate(dateObj){
      const y = dateObj.getFullYear();
      const m = pad2(dateObj.getMonth()+1);
      const d = pad2(dateObj.getDate());
      return `${y}-${m}-${d}`;
    }

    function fmtDayBtn(dateObj){
      const dow = new Intl.DateTimeFormat("pt-BR", { weekday: "short" }).format(dateObj);
      const dm  = new Intl.DateTimeFormat("pt-BR", { day: "2-digit", month: "2-digit" }).format(dateObj);
      return { dow, dm };
    }

    // Data no formato BR (para mensagem)
    function formatDateBRInTZ(dateObj, timeZone){
      return new Intl.DateTimeFormat("pt-BR", {
        timeZone,
        weekday: "short",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      }).format(dateObj);
    }

    // Hora em AM/PM (para botÃµes e mensagem)
    function formatTimeAmPmInTZ(dateObj, timeZone){
      return new Intl.DateTimeFormat("en-US", {
        timeZone,
        hour: "numeric",
        minute: "2-digit",
        hour12: true
      }).format(dateObj);
    }

    // Retorna offset em minutos de um timeZone em relaÃ§Ã£o ao UTC para um Date especÃ­fico (considera DST)
    function getTimeZoneOffsetMinutes(date, timeZone){
      const dtf = new Intl.DateTimeFormat("en-US", {
        timeZone,
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit", second: "2-digit",
        hour12: false
      });

      const parts = dtf.formatToParts(date);
      const map = Object.fromEntries(parts.map(p => [p.type, p.value]));

      const asUTC = Date.UTC(
        Number(map.year),
        Number(map.month) - 1,
        Number(map.day),
        Number(map.hour),
        Number(map.minute),
        Number(map.second)
      );

      // âœ… SINAL CORRETO
      return (date.getTime() - asUTC) / 60000;
    }

    function buildDateFromCentralISO(dateISO, timeHHMM){
      // Interpreta dateISO + timeHHMM como horÃ¡rio em America/Chicago (CT) e devolve Date absoluto
      const [y, m, d] = dateISO.split("-").map(Number);
      const [hh, mm] = timeHHMM.split(":").map(Number);

      const utcGuess = new Date(Date.UTC(y, m - 1, d, hh, mm, 0));
      const offsetMin = getTimeZoneOffsetMinutes(utcGuess, CT_TZ);

      return new Date(utcGuess.getTime() + offsetMin * 60 * 1000);
    }

    function buildSlotLabels(dateISO, timeHHMM){
      const localTZ = getLocalTimeZone();
      const dt = buildDateFromCentralISO(dateISO, timeHHMM);

      const ctDate = formatDateBRInTZ(dt, CT_TZ);
      const ctTime = formatTimeAmPmInTZ(dt, CT_TZ);

      const localDate = formatDateBRInTZ(dt, localTZ);
      const localTime = formatTimeAmPmInTZ(dt, localTZ);

      const ctLabel    = `${ctDate} ${ctTime} (CT)`;
      const localLabel = `${localDate} ${localTime} (${localTZ})`;

      return { localLabel, ctLabel };
    }

    // ===== RENDER =====
    function renderDays(){
      daysEl.innerHTML = "";
      const today = new Date();
      let added = 0;

      for(let i=0; added < DAYS_AHEAD; i++){
        const d = new Date(today);
        d.setDate(today.getDate() + i);

        // âŒ pula domingo e sÃ¡bado
        if(d.getDay() === 0) continue;
        if(d.getDay() === 6) continue;

        const iso = isoFromDate(d);
        const { dow, dm } = fmtDayBtn(d);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "btnDay" + (selectedDayISO === iso ? " active" : "");
        btn.innerHTML = `<div class="dow">${dow.replace(".","")}</div><div class="dm">${dm}</div>`;

        btn.addEventListener("click", () => {
          selectedDayISO = iso;
          renderDays();
          renderTimes();
        });

        daysEl.appendChild(btn);
        added++;
      }

      // melhora UX no celular: garante que o "active" fique visÃ­vel
      const active = daysEl.querySelector(".btnDay.active");
      if(active && typeof active.scrollIntoView === "function"){
        active.scrollIntoView({ behavior: "smooth", inline: "start", block: "nearest" });
      }
    }

    function renderTimes(){
      timesEl.innerHTML = "";
      if(!selectedDayISO){
        timeNote.textContent = "Primeiro selecione um dia acima â˜ï¸";
        return;
      }
      timeNote.textContent = "HorÃ¡rios em Central Time (CT) â€” clique para adicionar (atÃ© 3)";

      const localTZ = getLocalTimeZone();

      AVAILABLE_TIMES.forEach(t => {
        const dt = buildDateFromCentralISO(selectedDayISO, t);

        const ctTime = formatTimeAmPmInTZ(dt, CT_TZ);
        const localTime = formatTimeAmPmInTZ(dt, localTZ);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "btnTime";
        btn.innerHTML = `
          <div class="ct">${ctTime} <span style="font-weight:700;opacity:.85;">CT</span></div>
          <div class="local">${localTime} seu horÃ¡rio</div>
        `;

        btn.addEventListener("click", () => {
          if(slots.length >= MAX_SLOTS){
            alert("VocÃª jÃ¡ adicionou 3 opÃ§Ãµes. Remova uma para adicionar outra ðŸ™‚");
            return;
          }

          const key = `${selectedDayISO}|${t}`;
          if(slots.some(s => s.key === key)){
            alert("VocÃª jÃ¡ adicionou essa mesma opÃ§Ã£o. Escolha outra data/horÃ¡rio ðŸ™‚");
            return;
          }

          const { localLabel, ctLabel } = buildSlotLabels(selectedDayISO, t);
          slots.push({ key, localLabel, ctLabel, dateISO: selectedDayISO, timeHHMM: t });
          renderChipsAndLink();
        });

        timesEl.appendChild(btn);
      });
    }

    function renderChipsAndLink(){
      chipsEl.innerHTML = "";

      slots.forEach((s, idx) => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.innerHTML = `
          ${idx+1}) ${s.ctLabel}
          <span>â†’ ${s.localLabel}</span>
          <button type="button" aria-label="Remover">âœ•</button>
        `;
        chip.querySelector("button").addEventListener("click", () => {
          slots.splice(idx, 1);
          renderChipsAndLink();
        });
        chipsEl.appendChild(chip);
      });

      const link = buildWhatsAppLink();
      waBtn.href = link;
      waBtnSticky.href = link;

      const disabled = (slots.length === 0);
      [waBtn, waBtnSticky].forEach(el => {
        el.style.pointerEvents = disabled ? "none" : "auto";
        el.style.opacity = disabled ? ".6" : "1";
      });
    }

    function buildMessage(){
      const name = (nameEl.value || "").trim();
      const localTZ = getLocalTimeZone();

      const header = name
        ? `OlÃ¡ Nutri, meu nome Ã© ${name} e quero marcar minha primeira consulta.`
        : `OlÃ¡ Nutri, quero marcar minha primeira consulta.`;

      if(slots.length === 0){
        return `${header}\n\nPode me ajudar com o agendamento? (Meu fuso: ${localTZ} | Seu fuso: Central Time)`;
      }

      const lines = slots.map((s, i) =>
        `${i+1}) Central Time (CT): ${s.ctLabel}\n   Meu horÃ¡rio: ${s.localLabel}`
      ).join("\n\n");

      const footer =
        `\n\nMeu fuso: ${localTZ}\nSeu fuso: Central Time (CT)`;

      return `${header}\n\nMinhas opÃ§Ãµes:\n\n${lines}${footer}`;
    }

    function buildWhatsAppLink(){
      const msg = encodeURIComponent(buildMessage());
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
    }

    // ===== INIT =====
    const localTZ = getLocalTimeZone();
    tzInfoEl.value = `Seu fuso: ${localTZ}\nMeu fuso: Central Time (CT)`;

    // Seleciona amanhÃ£ por padrÃ£o
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    selectedDayISO = isoFromDate(tomorrow);

    renderDays();
    renderTimes();
    renderChipsAndLink();

    clearBtn.addEventListener("click", () => {
      slots = [];
      renderChipsAndLink();
    });
  </script>
</body>
</html>
